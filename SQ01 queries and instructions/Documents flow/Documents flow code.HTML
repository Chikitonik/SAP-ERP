<html><head><!--750:EUP --><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta http-equiv="content-style-type" content="text/css"><style> body{ background-color:#F1F6EA; color:#000000; font-family:Tahoma,helvetica,sans-serif; font-size:9pt; }table{ font-family:Tahoma,helvetica,sans-serif; font-size:9pt; } table.dd{ border-width:2px; border-style:solid; border-collapse:collapse; border-color:#4F556A; }table.dd th{ border-width:1px; padding:2px; border-style:solid; background:#6780B8; color:#FFFFFF; } table.dd td{ border-width:1px; padding:2px; border-style:solid; }table.trans{ border-style:none } table.trans td{ border-style:none; padding:0 } table.trans table.dd table.trans td{ border-style:none; padding:0 }table.trans table.dd td{ border-style:solid; padding:2px; }button{ font-family:Tahoma,helvetica,sans-serif; font-size:9pt; background-color:#F1F6EA; margin:0px; width:100%; cursor:pointer; height:22px; text-align:center; vertical-align:top; white-space:nowrap; background-image:url(back.gif); padding-left:5px; padding-right:5px; border-left:1px solid gray; border-right:1px solid gray; border-top:1px solid gray; border-bottom:1px solid gray; }button .imgButtonLabel{ padding-left:5px; }input{ font-family:Tahoma,helvetica,sans-serif; font-size:9pt; } select{ font-family:Tahoma,helvetica,sans-serif; font-size:9pt; }a{ text-decoration:none; color:#0063A4; } a:hover{ text-decoration:underline; } a:visited{ color:#666666; }.HEADING{ font-size:17pt; } .KEY{ background-color:#CCE3E3; } .SUCCESS{ background-color:#C6F9C1; } .WARNING{ background-color:#FF988C; }.HEADER1{ background:#6780B8; font-family:Tahoma,helvetica,sans-serif; color:#FFFFFF; }</style><script language="JavaScript"> var enter_pressed = " "; function ButtonClick(form,button) { if(enter_pressed == " "){ fname=form.name; form.sapbu_cl.value=button.id; form.sapse_cl.value=" "; form.sapin_cl.value=" "; document[fname].submit();} else{enter_pressed = " "; } }function SelectChange(form,select) { fname=form.name; form.sapbu_cl.value=" "; form.sapse_cl.value=select.id; form.sapin_cl.value=" "; document[fname].submit();}function InputHelpF1(form,input) { fname=form.name; form.sapbu_cl.value=" "; form.sapse_cl.value=" "; form.sapin_cl.value=input.id + "sapHELPF1"; document[fname].submit();}function InputKeyDown(event,form,input) {form.sapbu_cl.value=" "; form.sapse_cl.value=" "; if(event.keyCode == 115) {form.sapin_cl.value=input.id+"sapHELPF4"; fname=form.name; document[fname].submit();} if(event.keyCode == 13 || event.keyCode == 10) { form.sapin_cl.value=input.id+"sapENTER"; enter_pressed="X"; fname=form.name; document[fname].submit();} }function toggle(areaname) { target = document.all(areaname); if (target.style.display == "none") { target.style.display = "";} else { target.style.display = "none"; } }
</script></head><body><!%_BODYSTART> <br> <br> <span class="HEADING">Описание&#x20;инфо-набора&#x3a;&#x20;ZRX_STORNO</span> <a name="A"></a> <br> <span style=" font-size:11pt;">Поток&#x20;документов&#x20;сторно</span> <hr><span style=" background-color:#FF988C; font-size:11pt; font-style:italic;">Сгенерированный&#x20;вариант</span> <a name="A"></a> <hr> <br><!%_A1T3!> <table class="trans" cellpadding="0" cellspacing="0" id="A1T3" width="50&#x25;"<colgroup><col id="COL1"><col id="COL2"><col id="COL3"></colgroup><tbody><tr bgcolor=""><td>Автор</td><td>RXOLODKOV</td><td>26.06.2021</td></tr><tr bgcolor=""> <td>Последним&#x20;изменил</td><td>RXOLODKOV</td><td>26.06.2021</td></tr><tr bgcolor=""> </tr><tr bgcolor=""> <td>Пакет</td><td>&#x24;TMP</td></tr><tr bgcolor=""><td>Группа&#x20;полномочий</td><td>Нет</td></tr><tr bgcolor=""> <td>Идентификация&#x20;текста</td><td>с&#x20;классом&#x20;CL_TEXT_IDENTIFIER</td></tr><tr bgcolor=""><td>Сбор&#x20;данных&#x20;Через&#x20;оператора&#x20;соед.&#x20;таблиц</td></tr><tr bgcolor=""> </tr><tr bgcolor=""><!%_CURSOR!><!A1T3></tr></tbody></table><!%_/A1T3!> <br> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Таблицы-псевдонимы</span> <a name="ALG"></a> <br> <br> <span>Нет</span> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"><a id="A1L5" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Оператор&#x20;соединен.&#x20;таблиц</span> <a name="JOG"></a> <br> <br><span>VBRP&#x20;INNER&#x20;JOIN&#x20;VBRK&#x20;INNER&#x20;JOIN&#x20;KNA1&#x20;INNER&#x20;JOIN&#x20;VBAP</span> <br> <br>
<span>Условия<br><br>VBRK-KUNRG&#x20;&#x3d;&#x20;KNA1-KUNNR<br>VBRP-AUBEL&#x20;&#x3d;&#x20;VBAP-VBELN<br>VBRP-AUPOS&#x20;&#x3d;&#x20;VBAP-POSNR<br>VBRP-VBELN&#x20;&#x3d;&#x20;VBRK-VBELN<br></span> <br> <br><img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L7" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Группы&#x20;полей&#x20;и&#x20;присвоенные&#x20;поля</span><a name="SGG"></a> <br> <br><!%_A1T9!> <table class="dd" id="A1T9" width="100&#x25;"<colgroup><col id="COL1"></colgroup><tbody><tr bgcolor="#F1F6EA"><td class="HEADER1">Группа&#x20;полей&#x20;Фактура&#x3a;&#x20;данные&#x20;позиции</td></tr><tr bgcolor="#F1F6EA"><!%_CURSOR!><!A1T9></tr></tbody></table><!%_/A1T9!><!%_A1T10!> <table class="dd" id="A1T10" width="100&#x25;"<colgroup><col id="COL1"><col id="COL2"><col id="COL3"><col id="COL4"></colgroup><tbody>
<tr bgcolor="#F1F6EA"><td class="HEADER1">Поле</td><td class="HEADER1">Название</td><td class="HEADER1">Заголовок</td><td class="HEADER1">Текстовое&#x20;поле</td></tr><tr bgcolor="#F1F6EA"><td>KNA1-NAME1</td><td>Имя&#x20;1</td><td>Имя&#x20;1</td><td>-</td></tr><tr bgcolor="#F1F6EA"> <td>VBRP-VBELN</td><td>Фактура</td><td>Фактура</td><td>VBUK-VBTYP_EXT</td></tr><tr bgcolor="#F1F6EA"><td>VBRP-NETWR</td><td>Стоимость&#x20;нетто&#x20;позиции&#x20;фактуры&#x20;в&#x20;валюте&#x20;документа</td><td>Стоимость&#x20;нетто</td><td>-</td></tr><tr bgcolor="#F1F6EA"><td>VBRP-VGBEL</td><td>Номер&#x20;документа-образца</td><td>ДокОбразец</td><td>VBUK-VBTYP_EXT</td></tr><tr bgcolor="#F1F6EA"> <td>VBRP-ERDAT</td><td>Дата&#x20;создания&#x20;записи</td><td>ДатаСоздан</td><td>-</td></tr><tr bgcolor="#F1F6EA"><td>VBRP-WERKS</td><td>Завод</td><td>З-д</td><td>T001W-NAME1</td></tr><tr bgcolor="#F1F6EA"> <td>VBRP-SPART</td><td>Сектор</td><td>Ск</td><td>TSPAT-VTEXT</td></tr><tr bgcolor="#F1F6EA"><td>VBRP-AUBEL</td><td>Торговый&#x20;документ</td><td>ТоргДокум</td><td>VBUK-VBTYP_EXT</td></tr><tr bgcolor="#F1F6EA"> <td>VBRP-AUPOS</td><td>Позиция&#x20;торгового&#x20;документа</td><td>Поз.</td><td>-</td></tr><tr bgcolor="#F1F6EA"><td>VBAP-SOBKZ</td><td>Код&#x20;особого&#x20;запаса</td><td>О</td><td>T148T-SOTXT</td></tr><tr bgcolor="#F1F6EA"> <td>VBELN_RE</td><td>Номер&#x20;возврата</td><td>Номер&#x20;возврата</td><td>VBUK-VBTYP_EXT</td></tr><tr bgcolor="#F1F6EA"><!%_CURSOR!><!A1T10></tr></tbody></table><!%_/A1T10!> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L11" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Дополнит.&#x20;таблицы</span> <a name="ZTG"></a><br> <br> <span>Нет</span> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L13" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br><span style=" font-size:11pt; font-weight:bold;">Дополнит.&#x20;поля</span> <a name="ZFG"></a> <br><!%_A1T15!> <table class="dd" id="A1T15" width="100&#x25;"<colgroup><col id="COL1"><col id="COL2"><col id="COL3"><col id="COL4"><col id="COL5"><col id="COL6">
<col id="COL7"><col id="COL8"><col id="COL9"></colgroup><tbody><tr bgcolor="#F1F6EA"><td class="HEADER1">Поле</td><td class="HEADER1">Название&#x20;поля&#x20;и&#x20;заголовки</td><td class="HEADER1">Присвоено&#x20;таблице&#x3a;</td><td class="HEADER1">Последовательн.</td><td class="HEADER1">Тип</td><td class="HEADER1">LIKE-поле&#x2f;тип&#x20;ABAP-слов.</td><td class="HEADER1">Длина</td><td class="HEADER1">Длина&#x20;вывода</td><td class="HEADER1">Десятичные&#x20;разряды</td></tr><tr bgcolor="#F1F6EA"><td>NAME1_KNA1</td><td>Покупатель&#x20;&#x2f;&#x20;Покупатель</td><td>VBRP</td><td>01</td><td>C</td><td>KNA1-NAME1</td><td>035</td><td>035</td><td>00</td></tr><tr bgcolor="#F1F6EA"> <td>Кодировка</td><td colspan="8">&nbsp;</td></tr><tr bgcolor="#F1F6EA"><td>VBELN_RE</td><td>Номер&#x20;возврата&#x20;&#x2f;&#x20;Номер&#x20;возврата</td><td>VBRP</td><td>01</td><td>C</td><td>VBAK-VBELN</td><td>010</td><td>010</td><td>00</td></tr><tr bgcolor="#F1F6EA"><td>Кодировка</td><td colspan="8">SELECT&#x20;SINGLE&#x20;VBELN&#x20;INTO&#x20;VBELN_RE&#x20;FROM&#x20;VBFA<br>&#x20;&#x20;WHERE&#x20;VBELV&#x20;&#x3d;&#x20;VBRP-VBELN&#x20;and&#x20;VBTYP_N&#x20;&#x3d;&#x20;&#x27;H&#x27;.<br></td></tr><tr bgcolor="#F1F6EA"> </tr><tr bgcolor="#F1F6EA"><!%_CURSOR!><!A1T15></tr></tbody></table><!%_/A1T15!> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L16" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Доп.&#x20;структуры</span> <a name="ZSG"></a><br> <br> <span>Нет</span> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L18" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br><span style=" font-size:11pt; font-weight:bold;">Критерии&#x20;выбора</span> <a name="ABG"></a> <br> <br> <span>Нет</span> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"><a id="A1L20" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr> <br> <span style=" font-size:11pt; font-weight:bold;">Кодировки</span> <a name="COG"></a> <br><!%_A1T22!> <table class="dd" id="A1T22" width="100&#x25;"<colgroup><col id="COL1" width="37&#x25;">
<col id="COL2" width="60&#x25;"><col id="COL3" width="3&#x25;"></colgroup><tbody><tr class="HEADER1"><td id="A1T22C1R0">Момент&#x20;времени</td><td id="A1T22C2R0">Кодировка</td><td id="A1T22C3R0">Последовательн.</td> <!--END_OF_HEADINGS--></tr><tr bgcolor="#F1F6EA"><td id="A1T22C1R1"></td><td id="A1T22C2R1"></td>
<td id="A1T22C3R1"></td></tr><tr bgcolor="#F1F6EA"><td id="A1T22C1R2"> <span>START-OF-SELECTION</span><!%_CURSOR!><!A1T22C1></td><td id="A1T22C2R2"><span>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;get&#x20;data&#x20;from&#x20;selection&#x20;screen&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;gt_view&#x20;TYPE&#x20;ztbpf_base_rsparams.&#x20;&#x22;z&#x20;type&#x20;is&#x20;already&#x20;in&#x20;the&#x20;sestem<br>&#x20;&#x20;CALL&#x20;FUNCTION&#x20;&#x27;RS_REFRESH_FROM_SELECTOPTIONS&#x27;<br>&#x20;&#x20;&#x20;&#x20;EXPORTING<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;curr_report&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;sy-repid<br>&#x20;&#x20;&#x20;&#x20;TABLES<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;selection_table&#x20;&#x3d;&#x20;gt_view<br>&#x20;&#x20;&#x20;&#x20;EXCEPTIONS<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;not_found&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;1<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;no_report&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;2<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;OTHERS&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;3.<br>&#x20;&#x20;IF&#x20;sy-subrc&#x20;NE&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Не&#x20;верно&#x20;заполнен&#x20;селекционный&#x20;экран&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;RETURN.<br>&#x20;&#x20;ENDIF.<br>&#x22;get&#x20;invoice&#x20;number<br>DATA&#x3a;&#x20;lv_VBELN&#x20;TYPE&#x20;VBRP-VBELN,<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ls_view&#x20;LIKE&#x20;LINE&#x20;OF&#x20;gt_view.<br>READ&#x20;TABLE&#x20;gt_view&#x20;INTO&#x20;ls_view&#x20;WITH&#x20;KEY&#x20;SELNAME<br>&#x20;&#x3d;&#x20;&#x27;SP&#x24;00001&#x27;.<br>lv_VBELN&#x20;&#x3d;&#x20;ls_view-LOW.&#x22;invoice&#x20;number<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;invoice&#x20;number&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;lv_VBOBJ&#x20;TYPE&#x20;VBUK-VBOBJ.<br>SELECT&#x20;SINGLE&#x20;VBOBJ&#x20;INTO&#x20;lv_VBOBJ&#x20;FROM&#x20;VBUK<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.
<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_VBOBJ&#x20;&lt;&gt;&#x20;&#x27;F&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Введен&#x20;не&#x20;номер&#x20;фактуры&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;EXIT.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;that&#x20;there&#x20;is&#x20;no&#x20;Cancel&#x20;Invoice&#x20;in&#x20;flow&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;that&#x20;invoice&#x20;number&#x20;is&#x20;not&#x20;Cancel&#x20;Invoice&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;Invoise&#x20;date&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;it&#x20;is&#x20;return&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;lv_FKSTO&#x20;TYPE&#x20;VBRK-FKSTO,<br>&#x20;&#x20;lv_VBTYP&#x20;TYPE&#x20;VBRK-VBTYP,<br>&#x20;&#x20;lv_ERDAT&#x20;TYPE&#x20;VBRK-ERDAT,<br>&#x20;&#x20;lv_FKART&#x20;TYPE&#x20;FKART.<br>SELECT&#x20;SINGLE&#x20;FKSTO&#x20;VBTYP&#x20;ERDAT&#x20;FKART<br>&#x20;&#x20;FROM&#x20;VBRK<br>&#x20;&#x20;INTO&#x20;&#x28;lv_FKSTO,&#x20;lv_VBTYP,&#x20;lv_ERDAT,&#x20;lv_FKART&#x29;<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.<br>lv_ERDAT&#x20;&#x3d;&#x20;lv_ERDAT&#x20;&#x2b;&#x20;60.<br>IF&#x20;lv_FKSTO&#x20;&#x3d;&#x20;&#x27;X&#x27;.<br>&#x20;&#x20;MESSAGE&#x20;&#x27;Фактура&#x20;уже&#x20;сторнирована&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;EXIT.<br>ELSEIF&#x20;lv_VBTYP&#x20;&#x3d;&#x20;&#x27;N&#x27;.<br>&#x20;&#x20;MESSAGE&#x20;&#x27;Введен&#x20;номер&#x20;сторнирующей&#x20;фактуры&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;EXIT.<br>ELSEIF&#x20;lv_ERDAT&#x20;&lt;&#x20;sy-datum.<br>&#x20;&#x20;MESSAGE&#x20;&#x27;Обратите&#x20;внимание,&#x20;дата&#x20;фактуры&#x20;более&#x20;2х&#x20;месяцев&#x20;назад&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;for&#x20;EDI&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x20;lv_clarIF_status&#x20;TYPE&#x20;&#x20;j_3rf_reginv_out-clarIF_status.<br>DATA&#x20;lv_doc_status&#x20;&#x20;&#x20;&#x20;TYPE&#x20;&#x20;j_3rf_reginv_out-doc_status.<br>SELECT&#x20;SINGLE&#x20;doc_status&#x20;clarIF_status<br>&#x20;&#x20;FROM&#x20;j_3rf_reginv_out<br>&#x20;&#x20;&#x20;&#x20;INTO&#x20;&#x28;lv_doc_status,&#x20;lv_clarIF_status&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;WHERE&#x20;vbeln_bdoc&#x20;&#x3d;&#x20;lv_VBELN.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;IF&#x20;sy-subrc&#x20;&#x3d;&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;IF&#x20;&#x28;&#x20;lv_clarIF_status&#x20;IS&#x20;INITIAL&#x20;AND&#x20;lv_doc_status&#x20;&#x3d;&#x20;&#x27;CR&#x27;&#x29;&#x20;or&#x20;&#x22;j3rdx_clar_note_created<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;lv_clarIF_status&#x20;IS&#x20;INITIAL&#x20;AND&#x20;lv_doc_status&#x20;&#x3d;&#x20;&#x27;SG&#x27;&#x29;&#x20;or&#x20;&#x22;j3rdx_clar_note_signed<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;lv_clarIF_status&#x20;&#x3d;&#x20;&#x27;AN&#x27;&#x20;or&#x20;&#x22;Annulment&#x20;created<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;lv_clarIF_status&#x20;&#x3d;&#x20;&#x27;AC&#x27;&#x20;or&#x20;&#x22;Annulment&#x20;Confirmed<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;lv_clarIF_status&#x20;&#x3d;&#x20;&#x27;HD&#x27;.&#x20;&#x22;ClarIFication&#x20;Handled&#x20;Уточнение&#x20;обработано<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;sy-subrc&#x20;&#x3d;&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ELSE.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;i000&#x28;zsdsoft&#x29;&#x20;WITH&#x20;&#x27;Фактура&#x20;выгружена&#x20;в&#x20;ЭДО.&#x20;Необходимо&#x20;анулирование&#x27;&#x20;DISPLAY&#x20;LIKE&#x20;IF_msg_output&#x3d;&gt;msgtype_error.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;sy-subrc&#x20;&#x3d;&#x20;4.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;EXIT.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ENDIF.
<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ELSE.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;sy-subrc&#x20;&#x3d;&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;for&#x20;returns&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>data&#x3a;&#x20;&#x20;begin&#x20;of&#x20;lt_VBELN_RE&#x20;occurs&#x20;1,&#x20;&#x22;returns&#x20;table<br>&#x20;&#x20;VBELN&#x20;type&#x20;VBRP-VBELN,<br>&#x20;&#x20;&#x20;&#x20;end&#x20;of&#x20;lt_VBELN_RE.<br>SELECT&#x20;VBELN&#x20;INTO&#x20;lt_VBELN_RE&#x20;FROM&#x20;VBFA<br>&#x20;&#x20;WHERE&#x20;VBELV&#x20;&#x3d;&#x20;lv_VBELN&#x20;and&#x20;VBTYP_N&#x20;&#x3d;&#x20;&#x27;H&#x27;.&#x20;&#x22;returns<br>&#x20;&#x20;INSERT&#x20;lt_VBELN_RE&#x20;INTO&#x20;TABLE&#x20;lt_VBELN_RE.<br>&#x20;&#x20;ENDSELECT.<br>data&#x3a;&#x20;lv_ABSTK&#x20;type&#x20;VBUK-ABSTK.<br>LOOP&#x20;AT&#x20;lt_VBELN_RE.<br>SELECT&#x20;SINGLE&#x20;ABSTK&#x20;INTO&#x20;lv_ABSTK&#x20;FROM&#x20;VBUK<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lt_VBELN_RE-VBELN.<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_ABSTK&#x20;&#x20;&#x3d;&#x20;&#x27;&#x27;.<br>&#x20;&#x20;&#x20;&#x20;ELSE.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_ABSTK&#x20;&lt;&gt;&#x20;&#x27;C&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Есть&#x20;не&#x20;сторнированный&#x20;возврат&#x21;&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;EXIT.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>ENDLOOP.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;for&#x20;EWM&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>data&#x3a;&#x20;&#x20;begin&#x20;of&#x20;lt_LIKP&#x20;occurs&#x20;1,&#x20;&#x22;delivery&#x27;s&#x20;table<br>&#x20;&#x20;VGBEL&#x20;type&#x20;VBRP-VGBEL,&#x20;&#x22;delivery&#x27;s&#x20;number<br>&#x20;&#x20;&#x20;&#x20;end&#x20;of&#x20;lt_LIKP.<br>SELECT&#x20;VGBEL&#x20;INTO&#x20;lt_LIKP&#x20;FROM&#x20;VBRP&#x20;&#x22;put&#x20;in&#x20;structure<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.<br>&#x20;&#x20;INSERT&#x20;lt_LIKP&#x20;INTO&#x20;TABLE&#x20;lt_LIKP.&#x20;&#x22;append&#x20;to&#x20;table<br>&#x20;&#x20;ENDSELECT.<br>data&#x3a;&#x20;lv_VLSTK&#x20;type&#x20;LIKP-VLSTK.<br>SELECT&#x20;SINGLE&#x20;VLSTK&#x20;INTO&#x20;lv_VLSTK&#x20;FROM&#x20;LIKP<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lt_LIKP-VGBEL.<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_VLSTK&#x20;&#x3d;&#x20;&#x27;C&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Продажа&#x20;из&#x20;EWM&#x21;&#x21;&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;for&#x20;MMV&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>data&#x3a;&#x20;lv_TKNUM&#x20;type&#x20;ZSTAGE_DRIVER_WF-TKNUM.<br>lv_TKNUM&#x20;&#x3d;&#x20;0.<br>SELECT&#x20;SINGLE&#x20;TKNUM&#x20;INTO&#x20;lv_TKNUM&#x20;FROM&#x20;ZSTAGE_DRIVER_WF<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lt_LIKP-VGBEL.<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_TKNUM&#x20;&lt;&gt;&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Поставка&#x20;ММВ,&#x20;только&#x20;сторно&#x20;фактуры,&#x20;без&#x20;сторно&#x20;ОМ&#x21;&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;get&#x20;FUTD&#x20;data&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;
<br>DATA&#x3a;<br>&#x20;&#x20;begin&#x20;of&#x20;ls_DATA_FUTD,<br>&#x20;&#x20;WERKS&#x20;type&#x20;VBRP-WERKS,&#x20;&#x22;plant<br>&#x20;&#x20;VTWEG_AUFT&#x20;type&#x20;VBRP-VTWEG_AUFT,&#x20;&#x22;distribute&#x20;channel<br>&#x20;&#x20;SPART&#x20;type&#x20;VBRP-SPART,&#x20;&#x22;division<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;end&#x20;of&#x20;ls_DATA_FUTD.<br>SELECT&#x20;SINGLE&#x20;WERKS&#x20;VTWEG_AUFT&#x20;SPART&#x20;INTO&#x20;ls_DATA_FUTD&#x20;FROM&#x20;VBRP<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.<br>DATA&#x20;ULFUTD&#x28;4&#x29;.<br>&#x2a;get&#x20;data&#x20;from&#x20;202<br>IF&#x20;lv_FKART&#x20;&#x3d;&#x20;&#x27;RE&#x27;.<br>MESSAGE&#x20;&#x27;Это&#x20;возврат,&#x20;перед&#x20;сторно&#x20;проверь&#x20;остатки&#x21;&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;SELECT&#x20;SINGLE&#x20;W_OWNER<br>&#x20;&#x20;&#x20;&#x20;FROM&#x20;ZFUTN_RETURN<br>&#x20;&#x20;&#x20;&#x20;&#x22;CLIENT&#x20;SPECIFIED&#x20;-&#x20;IF&#x20;request&#x20;is&#x20;from&#x20;another&#x20;client&#x20;&#x28;MANDT&#x29;<br>&#x20;&#x20;&#x20;&#x20;CLIENT&#x20;SPECIFIED&#x20;INTO&#x20;ULFUTD<br>&#x20;&#x20;&#x20;WHERE&#x20;MANDT&#x20;&#x3d;&#x20;&#x27;202&#x27;&#x20;and&#x20;VBELN_VF&#x20;&#x3d;&#x20;lv_VBELN.<br>ELSE.<br>SELECT&#x20;SINGLE&#x20;W_OWNER3<br>&#x20;&#x20;FROM&#x20;ZFUTN_MSALE<br>&#x20;&#x20;CLIENT&#x20;SPECIFIED&#x20;INTO&#x20;ULFUTD<br>&#x20;&#x20;WHERE&#x20;MANDT&#x20;&#x3d;&#x20;&#x27;202&#x27;&#x20;and&#x20;VBELN_VF&#x20;&#x3d;&#x20;lv_VBELN.<br>ENDIF.<br>DATA&#x3a;&#x20;lv_FUTD_SPART_CHECK&#x28;1&#x29;.&#x20;&#x22;check&#x20;division<br>lv_FUTD_SPART_CHECK&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x22;http&#x3a;&#x2f;&#x2f;abap4.ru&#x2f;regular-expression.html,&#x20;check&#x20;division&#x20;consist&#x20;2&#x20;numbers<br>FIND&#x20;regex&#x20;&#x27;&#x5c;d&#x5c;d&#x27;&#x20;IN&#x20;ls_DATA_FUTD-SPART.<br>&#x20;&#x20;IF&#x20;sy-subrc&#x20;&#x3d;&#x20;0.<br>&#x20;&#x20;&#x20;&#x20;lv_FUTD_SPART_CHECK&#x20;&#x3d;&#x20;&#x27;N&#x27;.<br>&#x20;&#x20;ELSE.<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;ULFUTD&#x20;IS&#x20;INITIAL.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;ЮЛ&#x20;ФУТД&#x20;не&#x20;определено&#x21;&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;plant&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;lt_werks_nn&#x20;TYPE&#x20;RANGE&#x20;OF&#x20;bukrs,&#x20;lv_NNOV&#x28;1&#x29;.<br>&#x20;&#x20;lt_werks_nn&#x20;&#x3d;&#x20;VALUE&#x20;&#x23;&#x28;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;4120&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;5120&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;CE07&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;HE07&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;NE07&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x20;&#x20;&#x28;&#x20;sign&#x20;&#x3d;&#x20;&#x27;I&#x27;&#x20;option&#x20;&#x3d;&#x20;&#x27;EQ&#x27;&#x20;low&#x20;&#x3d;&#x20;&#x27;SE07&#x27;&#x20;&#x29;<br>&#x20;&#x20;&#x29;.<br>IF&#x20;&#x20;ls_DATA_FUTD-WERKS&#x20;IN&#x20;lt_werks_nn&#x20;AND&#x20;lv_TKNUM&#x20;&#x3d;&#x20;0.&#x22;IF&#x20;not&#x20;MMV.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;MESSAGE&#x20;&#x27;Это&#x20;Нижний,&#x20;они&#x20;просят&#x20;делать&#x20;только&#x20;сторно&#x20;фактуры&#x20;и&#x20;ОМ,&#x20;поставку&#x20;не&#x20;обнулять,&#x20;заказ&#x20;не&#x20;отклонять&#x27;&#x20;TYPE&#x20;&#x27;I&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;lv_NNOV&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;order&#x27;s&#x20;table&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;
<br>data&#x3a;&#x20;&#x20;begin&#x20;of&#x20;lt_ORDER&#x20;occurs&#x20;1,<br>&#x20;&#x20;AUBEL&#x20;type&#x20;VBRP-AUBEL,&#x20;&#x22;order&#x20;num<br>&#x20;&#x20;AUPOS&#x20;type&#x20;VBRP-AUPOS,&#x20;&#x22;opder&#x20;pos<br>&#x20;&#x20;&#x20;&#x20;end&#x20;of&#x20;lt_ORDER.<br>SELECT&#x20;AUBEL&#x20;AUPOS&#x20;INTO&#x20;lt_ORDER&#x20;FROM&#x20;VBRP<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.<br>&#x20;&#x20;INSERT&#x20;lt_ORDER&#x20;INTO&#x20;TABLE&#x20;lt_ORDER.<br>&#x20;&#x20;ENDSELECT.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;check&#x20;special&#x20;stock&#x20;E&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;lv_SOBKZ&#x28;1&#x29;.<br>DATA&#x3a;&#x20;lv_E_ZAPAS&#x28;1&#x29;.<br>lv_E_ZAPAS&#x28;1&#x29;&#x20;&#x3d;&#x20;&#x27;N&#x27;.<br>LOOP&#x20;AT&#x20;lt_ORDER.<br>SELECT&#x20;SINGLE&#x20;SOBKZ&#x20;INTO&#x20;lv_SOBKZ&#x20;FROM&#x20;VBAP<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lt_ORDER-AUBEL.<br>&#x20;&#x20;&#x20;&#x20;IF&#x20;lv_SOBKZ&#x20;&#x20;&#x3d;&#x20;&#x27;E&#x27;.<br>&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;lv_E_ZAPAS&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x20;&#x20;&#x20;&#x20;ENDIF.<br>ENDLOOP.<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;text&#x20;for&#x20;closing&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;&#x2a;<br>DATA&#x3a;&#x20;lv_DATE&#x20;type&#x20;VBRP-ERDAT.&#x22;invoice&#x20;date<br>DATA&#x3a;&#x20;lv_DAY&#x28;2&#x29;,&#x20;lv_MON&#x28;2&#x29;,&#x20;lv_YEAR&#x28;4&#x29;,&#x20;lv_DATE_OUT&#x28;10&#x29;.<br>SELECT&#x20;SINGLE&#x20;ERDAT&#x20;INTO&#x20;lv_DATE&#x20;FROM&#x20;VBRP<br>&#x20;&#x20;WHERE&#x20;VBELN&#x20;&#x3d;&#x20;lv_VBELN.<br>&#x20;&#x20;lv_YEAR&#x20;&#x3d;&#x20;lv_DATE&#x28;4&#x29;.<br>&#x20;&#x20;lv_MON&#x20;&#x3d;&#x20;lv_DATE&#x2b;4&#x28;2&#x29;.<br>&#x20;&#x20;lv_DAY&#x20;&#x3d;&#x20;lv_DATE&#x2b;6&#x28;2&#x29;.<br>CONCATENATE&#x20;lv_DAY&#x20;&#x27;.&#x27;&#x20;lv_MON&#x20;&#x27;.&#x27;&#x20;lv_YEAR&#x20;&#x20;INTO&#x20;lv_DATE_OUT.<br>DATA&#x3a;&#x20;lv_OUT_TEXT1&#x28;120&#x29;&#x20;type&#x20;C,&#x20;lv_OUT_TEXT3&#x28;120&#x29;&#x20;type&#x20;C,&#x20;lv_OUT_TEXT4&#x28;120&#x29;&#x20;type&#x20;C.<br>CONCATENATE&#x20;&#x27;Фактура&#x27;&#x20;lv_VBELN&#x20;&#x27;от&#x27;&#x20;lv_DATE_OUT&#x20;&#x27;сторнирована&#x27;&#x20;INTO&#x20;lv_OUT_TEXT1&#x20;SEPARATED&#x20;BY&#x20;space.<br>IF&#x20;lv_FUTD_SPART_CHECK&#x20;&#x3d;&#x20;&#x27;N&#x27;.&#x20;&#x22;сектор&#x20;из&#x20;2х&#x20;цифр&#x22;<br>&#x20;&#x20;lv_OUT_TEXT3&#x20;&#x3d;&#x20;&#x27;1С&#x20;БП&#x20;без&#x20;изменений&#x27;.<br>ELSE.<br>&#x20;&#x20;lv_OUT_TEXT3&#x20;&#x3d;&#x20;&#x27;1С&#x20;БП&#x20;проверить&#x20;наличие&#x20;и&#x20;удалить&#x20;док&#x20;ERP&#x27;.<br>CONCATENATE&#x20;&#x27;№&#x27;&#x20;lv_VBELN&#x20;&#x27;от&#x27;&#x20;lv_DATE_OUT&#x20;ULFUTD&#x20;INTO&#x20;lv_OUT_TEXT4&#x20;SEPARATED&#x20;BY&#x20;space.<br>ENDIF.<br>&#x22;IF&#x20;lv_NO_FUTD&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x22;&#x20;&#x20;exit.<br>&#x22;ELSE.<br>&#x22;CALL&#x20;FUNCTION&#x20;&#x27;POPUP_TO_INFORM&#x27;&#x20;&#x22;выпадающее&#x20;окно&#x20;на&#x20;4&#x20;строки&#x22;<br>&#x22;&#x20;&#x20;&#x20;&#x20;EXPORTING<br>&#x22;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;titel&#x20;&#x3d;&#x20;&#x27;Для&#x20;копирования&#x20;в&#x20;наряд&#x27;<br>&#x22;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;txt1&#x20;&#x20;&#x3d;&#x20;lv_OUT_TEXT1<br>&#x22;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;txt2&#x20;&#x20;&#x3d;&#x20;lv_OUT_TEXT2<br>&#x22;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;txt3&#x20;&#x20;&#x3d;&#x20;lv_OUT_TEXT3<br>&#x22;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;txt4&#x20;&#x20;&#x3d;&#x20;lv_OUT_TEXT4.<br>&#x22;ENDIF.<br>DATA&#x20;&#x3a;&#x20;&#x20;li_txline&#x20;&#x20;TYPE&#x20;STANDARD&#x20;TABLE&#x20;OF&#x20;txline,&#x20;lv_INDEX&#x28;1&#x29;&#x20;TYPE&#x20;I.<br>lv_INDEX&#x20;&#x3d;&#x20;1.<br>INSERT&#x20;lv_OUT_TEXT1&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>IF&#x20;lv_NNOV&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x20;&#x20;INSERT&#x20;&#x27;ОМ&#x20;сторнирован.&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>&#x20;&#x20;INSERT&#x20;&#x27;Поставка&#x20;НЕ&#x20;обнулена,&#x20;заказ&#x20;НЕ&#x20;отклонен&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.
<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>ELSEIF&#x20;lv_TKNUM&#x20;&lt;&gt;&#x20;0.&#x22;IF&#x20;MMV<br>&#x20;&#x20;INSERT&#x20;&#x27;Дальнейшие&#x20;документы&#x20;необходимо&#x20;проводить&#x20;в&#x20;ММВ&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>ELSEIF&#x20;lv_FKART&#x20;&#x3d;&#x20;&#x27;RE&#x27;.<br>&#x20;&#x20;INSERT&#x20;&#x27;Кредитовое&#x20;авизо&#x20;сторнировано,&#x20;ПМ&#x20;сторнирован,&#x20;возврат&#x20;отклонен&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>&#x20;&#x20;INSERT&#x20;&#x27;&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>ELSE.<br>&#x20;&#x20;INSERT&#x20;&#x27;ОМ&#x20;сторнирован,&#x20;поставка&#x20;обнулена,&#x20;заказ&#x20;отклонен&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>ENDIF.<br>IF&#x20;lv_VLSTK&#x20;&#x3d;&#x20;&#x27;C&#x27;.&#x20;&#x22;IF&#x20;EWM<br>&#x20;&#x20;INSERT&#x20;&#x27;Материал&#x20;перемещен&#x20;в&#x20;скл.место&#x20;OTKAZ_DOSTAVKA.&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>ELSE.<br>&#x20;&#x20;IF&#x20;lv_TKNUM&#x20;&#x3d;&#x20;0.&#x22;IF&#x20;no&#x20;MMV<br>&#x20;&#x20;&#x20;&#x20;INSERT&#x20;&#x27;Товар&#x20;в&#x20;916&#x20;типе&#x20;склада.&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>&#x20;&#x20;ENDIF.<br>ENDIF.<br>IF&#x20;lv_E_ZAPAS&#x20;&#x3d;&#x20;&#x27;Y&#x27;.<br>&#x20;&#x20;IF&#x20;lv_TKNUM&#x20;&#x3d;&#x20;0.&#x22;IF&#x20;no&#x20;MMV<br>&#x20;&#x20;&#x20;&#x20;INSERT&#x20;&#x27;ВАЖНО&#x3a;&#x20;Проверить&#x20;Е-запас,&#x20;при&#x20;необходимости&#x20;вывести&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>&#x20;&#x20;&#x20;&#x20;lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>&#x20;&#x20;ENDIF.<br>ENDIF.<br>INSERT&#x20;&#x27;&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>INSERT&#x20;&#x27;&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>INSERT&#x20;lv_OUT_TEXT3&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>INSERT&#x20;lv_OUT_TEXT4&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;lv_INDEX.<br>lv_INDEX&#x20;&#x3d;&#x20;lv_INDEX&#x20;&#x2b;&#x20;1.<br>&#x22;INSERT&#x20;&#x27;&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;8.<br>&#x22;INSERT&#x20;&#x27;&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;9.<br>&#x22;INSERT&#x20;&#x27;Для&#x20;сторно&#x20;нажмите&#x20;галочку,&#x20;для&#x20;продолжения&#x20;без&#x20;сторно&#x20;крестик&#x27;&#x20;INTO&#x20;li_txline&#x20;INDEX&#x20;9.<br>CALL&#x20;FUNCTION&#x20;&#x27;CATSXT_SIMPLE_TEXT_EDITOR&#x27;&#x20;&#x22;text&#x20;window<br>&#x20;&#x20;EXPORTING<br>&#x20;&#x20;&#x20;im_title&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;&#x27;Для&#x20;копирования&#x20;в&#x20;наряд&#x27;<br>&#x20;&#x20;&#x20;im_display_mode&#x20;&#x3d;&#x20;&#x27;X&#x27;&#x20;&#x22;or&#x20;&#x22;&#x22;&#x20;to&#x20;active&#x20;for&#x20;input<br>&#x20;&#x20;CHANGING<br>&#x20;&#x20;&#x20;ch_text&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x20;&#x3d;&#x20;li_txline&#x5b;&#x5d;.<br>IF&#x20;sy-ucomm&#x20;&#x3d;&#x20;&#x27;CX_CONT&#x27;.&#x22;IF&#x20;press&#x20;check&#x20;mark<br>&#x20;&#x20;&#x22;ENDIF.<br>ELSEIF&#x20;sy-ucomm&#x20;&#x3d;&#x20;&#x27;CX_CANC&#x27;.&#x22;IF&#x20;press&#x20;cross<br>ENDIF.<br>&#x22;добавить&#x20;при&#x20;EWM,<br>&#x22;при&#x20;ММВ,<br>&#x22;проверить&#x20;по&#x20;возвратам,<br>&#x22;для&#x20;нижнего&#x20;свое&#x20;сообщение&#x20;&#x28;если&#x20;ММВ&#x20;то&#x20;не&#x20;сообщать&#x29;,<br>&#x22;добавить&#x20;проверку&#x20;на&#x20;старый&#x20;год,<br>&#x22;добавить&#x20;имя&#x20;клиента<br>&#x22;поп&#x20;ап&#x20;с&#x20;меню&#x20;для&#x20;сторно&#x20;добавить<br></span><!%_CURSOR!><!A1T22C2></td><td id="A1T22C3R2"> <span>-</span>
<!%_CURSOR!><!A1T22C3></td></tr></tbody></table><!%_/A1T22!> <br> <br> <img src="s_tot_up.gif" alt="" title="" align="middle"> <a id="A1L23" href="#A" tabindex="0" title="">к&#x20;началу&#x20;документа</a> <hr><!%_CURSOR!><!A1><!%_BODYEND></body></html>
